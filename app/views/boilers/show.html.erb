<%#= javascript_include_tag "//www.google.com/jsapi", "chartkick" %>
<%= javascript_include_tag "chartkick" %>
<% title 'Boiler' %>
<p id="notice"><%= notice %></p>

<p>
  <b>Name:</b>
  <%= @boiler.name %>
</p>

<p>
  <b>When:</b>
  <%= Time.now.strftime("%d.%m.%Y %H:%M") %>
</p>

<p>
	<b>State:</b>
	<%= @boiler.get_value_with_path('Boiler/Boiler') %>
</p>

<table>
  <thead>
	<tr>
		<th>Path</th>
		<th>Value</th>
	</tr>
  </thead>
  <tbody>
	<% @boiler.mappings.select{|m| m.important}.each do |mapping| %>
      <tr>
	    <td><%= mapping.path %></td>
	    <td><%= mapping.get_formatted_value %></td>
	  </tr>
	<% end %>
  </tbody>
</table>
<% start_date = 1.week.ago.utc %>
<% datalogs = @boiler.datalogs.where('created_at > ?', start_date) %>
<%= line_chart datalogs.map {|d| [d.created_at, JSON.parse(d.dataset)['Boiler/Counters/Total consumed'].to_i]},
    library: {title: {text: "Wood pellet consumption (kg)"}} %>
<%= line_chart datalogs.map {|d| [d.created_at, JSON.parse(d.dataset)['Buffer/Buffer/demanded output/Charging Status'].to_i]},
    library: {title: {text: "Charge status (%)"}} %>
<br />
<%= link_to 'Edit', edit_boiler_path(@boiler) %> |
<%= link_to 'Back', boilers_path %>
